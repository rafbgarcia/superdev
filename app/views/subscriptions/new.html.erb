<script type="text/javascript" src="https://js.iugu.com/v2"></script>

<div class="container smaller">
  <div class="box">
    <h3>Comece sua jornada no SuperDev Academy</h3>

    <%#= form_for :subscription, method: :post do %>
      <!-- input type="text" name="customer[name]">
      <input type="text" name="customer[email]">
      <button type="submit">Manda</button> -->
    <%# end %>

    <div class="row">
      <div class="col-sm-6">
        <table class="table">
          <thead>
            <tr>
              <th>Descrição</th>
              <th class="tar">Valor</th>
            </tr>
          </thead>
          <thead>
            <tr>
              <td>Item 1</th>
              <td class="tar">R$ 59,90</th>
            </tr>
            <tr>
              <td>Item 2</th>
              <td class="tar">R$ 40,00</th>
            </tr>
            <tr class="order-total">
              <td>TOTAL</th>
              <td class="tar">R$ 99,90</th>
            </tr>
          </thead>
        </table>
      </div>
      <div class="col-sm-6 credit-card-payment">
        <%= form_for :subscription, url: subscribe_path, method: :post, id: 'payment-form' do %>
          <input type="hidden" name="mode" value="TEST">
          <div class="btn-group payment-method-btn-group" data-toggle="buttons">
            <label class="btn btn-default active" id="credit-card-checkbox-label">
              <input checked type="checkbox" id="credit-card-checkbox" name="method" value="">Cartão de Crédito</input>
            </label>
            <label class="btn btn-default" id="bank-slip-checkbox-label">
              <input type="checkbox" id="bank-slip-checkbox" name="method" value="bank_slip">Boleto Bancário</input>
            </label>
          </div>
          <div class="usable-creditcard-form">
            <div class="wrapper">
              <div class="input-group nmb_a">
                <div class="icon ccic-brand"></div>
                <input autocomplete="off" class="credit_card_number" data-iugu="number" placeholder="Número do Cartão" type="text" value="" />
              </div>
              <div class="input-group nmb_b">
                <div class="icon ccic-cvv"></div>
                <input autocomplete="off" class="credit_card_cvv" data-iugu="verification_value" placeholder="CVV" type="text" value="" />
              </div>
              <div class="input-group nmb_c">
                <div class="icon ccic-name"></div>
                <input class="credit_card_name" data-iugu="full_name" placeholder="Titular do Cartão" type="text" value="" />
              </div>
              <div class="input-group nmb_d">
                <div class="icon ccic-exp"></div>
                <input autocomplete="off" class="credit_card_expiration" data-iugu="expiration" placeholder="MM/AA" type="text" value="" />
              </div>
            </div>
            <div class="footer">
              <img src="http://storage.pupui.com.br/9CA0F40E971643D1B7C8DE46BBC18396/assets/cc-icons.e8f4c6b4db3cc0869fa93ad535acbfe7.png" alt="Visa, Master, Diners. Amex" border="0" />

              <a class="iugu-btn" href="http://iugu.com" tabindex="-1">
                <img src="http://storage.pupui.com.br/9CA0F40E971643D1B7C8DE46BBC18396/assets/payments-by-iugu.1df7caaf6958f1b5774579fa807b5e7f.png" alt="Pagamentos por Iugu" border="0" />
              </a>
            </div>
          </div>
          <input type="hidden" name="token" id="token" value="" readonly="true" size="64" style="text-align:center" />
          <div class="submit-div">
              <button type="submit" class="btn btn-primary">Pagar</button>
          </div>

        <% end %>
      </div>
    </div>

  </div>
</div>

<script>
  $(document).on('turbolinks:load', function () {

    Iugu.setAccountID("AEF33427575F47A981F718E7A4BD9B80");
    Iugu.setTestMode(true);

    $('#payment-form').submit(function (evt) {
      if ($('#credit-card-checkbox').attr('checked')) {
        var form = $(this);

        var tokenResponseHandler = function (data) {
          if (data.errors) {
            alert("Erro salvando cartão: " + JSON.stringify(data.errors));
          } else {
            $("#token").val(data.id);
            form.get(0).submit();
          }
        }

        Iugu.createPaymentToken(this, tokenResponseHandler);

        return false;
      } else {
        form.get(0).submit();
      }
    });

    cc_checkbox = $('#credit-card-checkbox')
    cc_checkbox_label = $('#credit-card-checkbox-label')
    bs_checkbox = $('#bank-slip-checkbox')
    bs_checkbox_label = $('#bank-slip-checkbox-label')
    credit_card_form = $('.usable-creditcard-form')

    cc_checkbox.click(function () {
      bs_checkbox_label.removeClass("active");
      cc_checkbox_label.addClass("active");
      bs_checkbox.removeAttr("checked");
      cc_checkbox.attr("checked", "checked");
      credit_card_form.show();
    });

    bs_checkbox.click(function () {
      cc_checkbox_label.removeClass("active");
      bs_checkbox_label.addClass("active");
      cc_checkbox.removeAttr("checked");
      bs_checkbox.attr("checked", "checked");
      credit_card_form.hide();
    });
  });
</script>
